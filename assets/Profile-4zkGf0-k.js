import{_ as H,f,g as F,L as G,c as l,b as t,j as R,t as c,F as D,h as A,p as V,i as Z,C as I,A as z,B as p,M as k,N as v,O as x,P as b,z as q,o as i,Q as S,R as E,S as O,T as $,U}from"./index-CCzS54Yh.js";const m=w=>(V("data-v-7ab9a77a"),w=w(),Z(),w),W={class:"container my-5"},J={class:"card p-4 shadow-sm mx-auto",style:{"max-width":"800px"}},K=m(()=>t("h2",{class:"display-4 text-center mb-4"},"Profil użytkownika",-1)),X={key:0,class:"text-center"},Y={key:1},tt=m(()=>t("strong",null,"Imię i nazwisko:",-1)),et=m(()=>t("strong",null,"Email:",-1)),nt=m(()=>t("h4",{class:"mt-4"},"Moje wizyty",-1)),ot={key:0,class:"text-muted"},at={key:1,class:"table-responsive"},st={class:"table mt-3"},lt=m(()=>t("thead",null,[t("tr",null,[t("th",null,"Przychodnia"),t("th",null,"Data"),t("th",null,"Godzina"),t("th",null,"Specjalizacja"),t("th",null,"Lekarz"),t("th",null,"Opis"),t("th",null,"Akcje")])],-1)),it=["onClick","disabled","title"],ct=m(()=>t("h4",{class:"mt-4"},"Moje konsultacje",-1)),rt={key:2,class:"text-muted"},dt={key:3,class:"table-responsive"},ut={class:"table mt-3"},pt=m(()=>t("thead",null,[t("tr",null,[t("th",null,"Data"),t("th",null,"Godzina"),t("th",null,"Opis problemu"),t("th",null,"Telefon"),t("th",null,"Załączniki"),t("th",null,"Akcje")])],-1)),ht={key:0},mt={key:1},yt=["href"],_t=["onClick"],ft={__name:"Profile",setup(w){const g=f({email:""}),B=f({name:""}),y=f([]),_=f([]),j=f(!1);function C(n){return n?(n instanceof Date?n:new Date(n)).toLocaleDateString("pl-PL",{year:"numeric",month:"2-digit",day:"2-digit"}):""}function N(n){const o=new Date;return(n instanceof Date?n:new Date(n))<o}async function L(n){try{const o=y.value.find(d=>d.id===n);if(!o)throw new Error("Nie znaleziono wizyty do anulowania.");const e=v(p,"clinics",o.clinicId,"appointments"),a=x(e,b("date","==",o.date),b("hour","==",o.hour),b("doctor","==",o.doctor)),s=await k(a);if(s.empty)throw new Error("Nie znaleziono odpowiadającej wizyty w klinice.");const h=s.docs[0].id,r=z(p,"users",g.value.uid,"appointments",n),u=z(p,"clinics",o.clinicId,"appointments",h);await Promise.all([S(r),S(u)]),y.value=y.value.filter(d=>d.id!==n)}catch(o){console.error("Błąd podczas anulowania wizyty:",o),alert("Wystąpił błąd podczas anulowania wizyty: "+o.message)}}async function M(n){try{const o=z(p,"remoteappointments",n),e=await I(o);if(e.exists()){const a=e.data();if(a.uploads&&a.uploads.length>0)for(let r of a.uploads){const u=E(O,r.url);try{await $(u)}catch(d){console.error(`Błąd podczas usuwania pliku ${r.url}:`,d)}}const s=E(O,`remoteappointments/${n}/`),h=await U(s);for(let r of h.items)try{await $(r)}catch(u){console.error(`Błąd podczas usuwania pliku z folderu ${r.fullPath}:`,u)}}await S(o),_.value=_.value.filter(a=>a.id!==n)}catch(o){console.error("Błąd podczas anulowania konsultacji:",o)}}function Q(n){confirm("Czy na pewno chcesz anulować tę wizytę?")&&L(n)}function T(n){confirm("Czy na pewno chcesz anulować tę konsultację zdalną?")&&M(n)}return F(()=>{G(q,async n=>{if(!n){j.value=!0;return}g.value=n;const o=await I(z(p,"users",n.uid));o.exists()&&(B.value={name:o.data().name||""});const e=await k(v(p,"users",n.uid,"appointments"));y.value=e.docs.map(a=>{const s=a.data();return{id:a.id,clinicName:s.clinicName,clinicId:s.clinicId,date:s.date.toDate(),hour:s.hour,specialization:s.specialization,doctor:s.doctor,description:s.description}});try{const a=x(v(p,"remoteappointments"),b("userId","==",n.uid)),s=await k(a);_.value=await Promise.all(s.docs.map(async h=>{const r=h.data();let u=[];try{const d=x(v(p,"remoteappointments",h.id,"uploads"));u=(await k(d)).docs.map(P=>({type:P.data().type,url:P.data().url}))}catch(d){console.error("Error loading attachments:",d)}return{id:h.id,date:r.date,contactHour:r.contactHour,description:r.description,phone:r.phone,uploads:u}}))}catch(a){console.error("Error loading remote appointments:",a),_.value=[]}j.value=!0})}),(n,o)=>(i(),l("div",W,[t("div",J,[K,j.value?(i(),l("div",Y,[t("p",null,[tt,R(" "+c(B.value.name||"—"),1)]),t("p",null,[et,R(" "+c(g.value.email),1)]),nt,y.value.length===0?(i(),l("div",ot," Brak zarezerwowanych wizyt. ")):(i(),l("div",at,[t("table",st,[lt,t("tbody",null,[(i(!0),l(D,null,A(y.value,e=>(i(),l("tr",{key:e.id},[t("td",null,c(e.clinicName),1),t("td",null,c(C(e.date)),1),t("td",null,c(e.hour),1),t("td",null,c(e.specialization),1),t("td",null,c(e.doctor),1),t("td",null,c(e.description),1),t("td",null,[t("button",{onClick:a=>Q(e.id),class:"btn btn-sm btn-danger",disabled:N(e.date),title:N(e.date)?"Nie można anulować przeszłej wizyty":""}," Anuluj wizytę ",8,it)])]))),128))])])])),ct,_.value.length===0?(i(),l("div",rt," Brak zarejestrowanych konsultacji zdalnych. ")):(i(),l("div",dt,[t("table",ut,[pt,t("tbody",null,[(i(!0),l(D,null,A(_.value,e=>(i(),l("tr",{key:e.id},[t("td",null,c(C(e.date)),1),t("td",null,c(e.contactHour),1),t("td",null,c(e.description),1),t("td",null,c(e.phone),1),t("td",null,[!e.uploads||e.uploads.length===0?(i(),l("span",ht,"Brak")):(i(),l("div",mt,[(i(!0),l(D,null,A(e.uploads,(a,s)=>(i(),l("span",{key:s,class:"d-block"},[t("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",class:"text-decoration-none"},c(a.type==="image"?"Zdjęcie":"Nagranie"),9,yt)]))),128))]))]),t("td",null,[t("button",{onClick:a=>T(e.id),class:"btn btn-sm btn-danger"}," Anuluj konsultację ",8,_t)])]))),128))])])]))])):(i(),l("div",X,"Ładowanie danych…"))])]))}},kt=H(ft,[["__scopeId","data-v-7ab9a77a"]]);export{kt as default};
