import{f as p,g as B,c as o,b as e,l as M,F as w,h as g,M as m,N as h,B as l,o as a,t as c,A as b,R as O,S as P,U as $,T as E,Q as I,O as U,P as z}from"./index-CCzS54Yh.js";const q={class:"container my-5 pt-5"},F=e("h1",{class:"mb-4"},"Panel Admina – wszystkie wizyty",-1),L={key:0,class:"text-center my-4"},R=e("div",{class:"spinner-border",role:"status"},[e("span",{class:"visually-hidden"},"Ładowanie...")],-1),T=[R],V={key:1},Z={key:0,class:"alert alert-info"},G={key:1,class:"table-responsive"},H={class:"table table-striped"},Q=e("thead",null,[e("tr",null,[e("th",null,"ID wizyty"),e("th",null,"Typ wizyty"),e("th",null,"Data"),e("th",null,"Godzina"),e("th",null,"Użytkownik"),e("th",null,"Przychodnia"),e("th",null,"Zdjęcia"),e("th",null,"Wiadomość głosowa"),e("th",null,"Opis"),e("th",null,"Akcje")])],-1),W={key:0},J={key:1},K=["src","onClick"],X={key:1},Y=["src"],ee={key:1},te=["onClick"],se={key:2},ne=e("div",{class:"modal-backdrop fade show"},null,-1),oe={class:"modal fade show d-block",tabindex:"-1"},ae={class:"modal-dialog modal-dialog-centered modal-lg"},ie={class:"modal-content"},le={class:"modal-body text-center"},ce=["src"],ue={__name:"Admin",setup(de){const d=p([]),v=p(!0),y=p(null);function D(s){return s!=null&&s.toDate?s.toDate():new Date(s)}async function x(){v.value=!0,d.value=[];const s=await m(h(l,"remoteappointments"));for(const t of s.docs){const n=t.data(),i=await m(h(l,"remoteappointments",t.id,"uploads")),f=[],_=[];i.docs.forEach(u=>{const k=u.data();k.type==="image"&&f.push(k.url),k.type==="audio"&&_.push(k.url)}),d.value.push({key:t.id,type:"remote",date:D(n.date),hour:n.contactHour||n.hour||"",userId:n.userId||"",images:f,audios:_,description:n.description||""})}const r=await m(h(l,"clinics"));for(const t of r.docs){const n=t.id,i=t.data().name||n;(await m(h(l,"clinics",n,"appointments"))).docs.forEach(_=>{const u=_.data();d.value.push({key:_.id,type:"clinic",clinicId:n,clinicName:i,date:D(u.date),hour:u.hour||"",userId:u.userId||"",images:[],audios:[],description:u.description||""})})}d.value.sort((t,n)=>t.date<n.date?-1:t.date>n.date?1:t.hour.localeCompare(n.hour)),v.value=!1}function A(s){y.value=s}function C(){y.value=null}async function S(s){const r=h(l,"users",s.userId,"appointments"),t=U(r,z("date","==",s.date),z("hour","==",s.hour),z("clinicId","==",s.clinicId)),n=await m(t);for(const i of n.docs)await I(b(l,"users",s.userId,"appointments",i.id))}async function j(s){if(s.type==="remote"){const r=b(l,"remoteappointments",s.key);await m(h(l,"remoteappointments",s.key,"uploads"));const t=O(P,`remoteappointments/${s.key}`),n=await $(t);await Promise.all(n.items.map(i=>E(i))),await I(r)}else await I(b(l,"clinics",s.clinicId,"appointments",s.key)),await S(s)}function N(s){confirm("Na pewno chcesz anulować tę wizytę?")&&j(s).then(x)}return B(x),(s,r)=>(a(),o("div",q,[F,v.value?(a(),o("div",L,T)):(a(),o("div",V,[d.value.length?(a(),o("div",G,[e("table",H,[Q,e("tbody",null,[(a(!0),o(w,null,g(d.value,t=>(a(),o("tr",{key:t.key},[e("td",null,c(t.key),1),e("td",null,c(t.type==="remote"?"Online":"Stacjonarna"),1),e("td",null,c(t.date.toLocaleDateString()),1),e("td",null,c(t.hour||"–"),1),e("td",null,c(t.userId),1),t.type==="clinic"?(a(),o("td",W,c(t.clinicName),1)):(a(),o("td",J,"–")),e("td",null,[t.images.length?(a(!0),o(w,{key:0},g(t.images,(n,i)=>(a(),o("img",{key:i,src:n,class:"img-thumbnail me-1",style:{width:"50px",height:"50px",cursor:"pointer"},onClick:f=>A(n)},null,8,K))),128)):(a(),o("span",X,"–"))]),e("td",null,[t.audios.length?(a(!0),o(w,{key:0},g(t.audios,(n,i)=>(a(),o("audio",{key:i,src:n,controls:"",class:"d-block mb-1"},null,8,Y))),128)):(a(),o("span",ee,"–"))]),e("td",null,c(t.description||"–"),1),e("td",null,[e("button",{class:"btn btn-sm btn-danger",onClick:n=>N(t)}," Anuluj ",8,te)])]))),128))])])])):(a(),o("div",Z," Brak wizyt do wyświetlenia. "))])),y.value?(a(),o("div",se,[ne,e("div",oe,[e("div",ae,[e("div",ie,[e("div",le,[e("img",{src:y.value,class:"img-fluid"},null,8,ce)]),e("div",{class:"modal-footer"},[e("button",{class:"btn btn-secondary",onClick:C},"Zamknij")])])])])])):M("",!0)]))}};export{ue as default};
