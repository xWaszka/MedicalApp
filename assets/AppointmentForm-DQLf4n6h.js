import{_ as le,f as u,Z as P,s as ie,g as ce,c as l,l as W,b as o,m as T,v as K,F as h,h as k,t as v,V as G,x as ue,u as re,M as q,N as D,p as de,i as ve,B as C,o as i,n as Y,z as pe,$ as me,W as Z}from"./index-CCzS54Yh.js";const p=x=>(de("data-v-23e3acaf"),x=x(),ve(),x),be={class:"container my-4"},_e={key:0,class:"mb-4"},ye=p(()=>o("h2",{class:"display-4 text-center mb-6"},"Umów wizytę – krok 1: wybierz przychodnię",-1)),fe={class:"mb-3"},he=p(()=>o("option",{disabled:"",value:""},"-- Wybierz przychodnię --",-1)),ke=["value"],we=["disabled"],ze={key:1,class:"mb-4"},ge={class:"d-flex justify-content-between align-items-center mb-3"},Se={class:"m-0"},De={class:"d-grid mb-2",style:{"grid-template-columns":"repeat(7, 1fr)","text-align":"center"}},Ce={class:"calendar"},xe=["onClick"],Me={key:0},Be={key:0,class:"mt-4"},Ie={class:"display-4 text-center"},Pe={class:"d-flex flex-wrap justify-content-center gap-2 mt-2"},Te=["disabled","onClick"],Ae={key:2,class:"mb-4"},Fe=p(()=>o("h2",{class:"display-4 text-center"},"Krok 3: szczegóły wizyty",-1)),Le=["onSubmit"],Ne={class:"mb-3"},Ve=p(()=>o("label",{class:"form-label"},"Specjalizacja:",-1)),je=p(()=>o("option",{disabled:"",value:""},"-- wybierz --",-1)),Oe=["value"],Ue={class:"mb-3"},We=p(()=>o("label",{class:"form-label"},"Lekarz:",-1)),Ke=p(()=>o("option",{disabled:"",value:""},"-- wybierz --",-1)),qe=["value"],He={class:"mb-3"},$e=p(()=>o("label",{class:"form-label"},"Opis dolegliwości:",-1)),Ee=p(()=>o("button",{type:"submit",class:"btn btn-success"},"Zapisz wizytę",-1)),Ge={__name:"AppointmentForm",setup(x){const w=u(1),A=u([]),d=u(""),m=u(null),z=u(null),M=new Date,g=u(M.getMonth()),S=u(M.getFullYear()),J=["Styczeń","Luty","Marzec","Kwiecień","Maj","Czerwiec","Lipiec","Sierpień","Wrzesień","Październik","Listopad","Grudzień"],Q=["Pn","Wt","Śr","Cz","Pt","So","Nd"],F=u([]),b=u({}),y=u({}),L=["09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00"],r=u({specialization:"",doctor:"",description:""}),B=u([]),I=P(()=>B.value.length),H=P(()=>{var e;if(!m.value||!z.value)return B.value;const t=m.value.date.toISOString().split("T")[0],s=((e=y.value[t])==null?void 0:e[z.value])||[];return B.value.filter(c=>!s.includes(c.name))}),R=P(()=>[...new Set(H.value.map(t=>t.specialization))]),X=P(()=>H.value.filter(t=>t.specialization===r.value.specialization));async function ee(){const t=await q(D(C,"clinics"));A.value=t.docs.map(s=>({id:s.id,...s.data()}))}async function $(){const t=await q(D(C,"clinics",d.value,"doctors"));B.value=t.docs.map(s=>({id:s.id,...s.data()}))}async function te(){const t=await q(D(C,"clinics",d.value,"appointments"));b.value={},y.value={},t.docs.forEach(s=>{const{date:e,hour:c,doctor:a}=s.data(),n=e.toDate().toISOString().split("T")[0];b.value[n]=b.value[n]||{},b.value[n][c]=(b.value[n][c]||0)+1,y.value[n]=y.value[n]||{},y.value[n][c]=y.value[n][c]||[],y.value[n][c].push(a)})}function E(){if(!d.value||I.value===0){F.value=[];return}const s=(new Date(S.value,g.value,1).getDay()+6)%7,e=new Date(S.value,g.value+1,0).getDate(),c=[];let a=Array(7).fill(null),n=1;for(let _=s;_<7;_++,n++){const f=new Date(S.value,g.value,n),V=f.toISOString().split("T")[0],j=b.value[V]||{},O=L.every(U=>(j[U]||0)>=I.value);a[_]={date:f,isPast:f<M,isBooked:O}}for(c.push(a);n<=e;){a=Array(7).fill(null);for(let _=0;_<7&&n<=e;_++,n++){const f=new Date(S.value,g.value,n),V=f.toISOString().split("T")[0],j=b.value[V]||{},O=L.every(U=>(j[U]||0)>=I.value);a[_]={date:f,isPast:f<M,isBooked:O}}c.push(a)}F.value=c}ie([g,S],E,{immediate:!0});async function se(){w.value=2,await $(),await te(),E()}function oe(t){!t.isBooked&&!t.isPast&&(m.value=t)}function N(t){var c;const s=m.value.date.toISOString().split("T")[0];return(((c=b.value[s])==null?void 0:c[t])||0)>=I.value}async function ae(t){N(t)||(z.value=t,w.value=3,await $())}async function ne(){const t=pe.currentUser;if(!t)return;const s={userId:t.uid,clinicId:d.value,clinicName:A.value.find(e=>e.id===d.value).name,date:me.fromDate(m.value.date),hour:z.value,specialization:r.value.specialization,doctor:r.value.doctor,description:r.value.description};await Z(D(C,"clinics",d.value,"appointments"),s),await Z(D(C,"users",t.uid,"appointments"),s),alert("Wizyta zarezerwowana!"),r.value={specialization:"",doctor:"",description:""},m.value=null,z.value=null,w.value=1}return ce(ee),(t,s)=>(i(),l("div",be,[w.value===1?(i(),l("div",_e,[ye,o("div",fe,[T(o("select",{"onUpdate:modelValue":s[0]||(s[0]=e=>d.value=e),class:"form-select"},[he,(i(!0),l(h,null,k(A.value,e=>(i(),l("option",{key:e.id,value:e.id},v(e.name),9,ke))),128))],512),[[K,d.value]])]),o("button",{class:"btn btn-primary",disabled:!d.value,onClick:se},"Dalej",8,we)])):w.value===2?(i(),l("div",ze,[o("div",ge,[o("button",{class:"btn btn-outline-secondary",onClick:s[1]||(s[1]=(...e)=>t.prevMonth&&t.prevMonth(...e))},"<"),o("h2",Se,v(J[g.value])+" "+v(S.value),1),o("button",{class:"btn btn-outline-secondary",onClick:s[2]||(s[2]=(...e)=>t.nextMonth&&t.nextMonth(...e))},">")]),o("div",De,[(i(),l(h,null,k(Q,e=>o("div",{key:e,class:"fw-bold"},v(e),1)),64))]),o("div",Ce,[(i(!0),l(h,null,k(F.value,(e,c)=>(i(),l("div",{key:c,class:"d-grid",style:{"grid-template-columns":"repeat(7, 1fr)","text-align":"center"}},[(i(!0),l(h,null,k(e,(a,n)=>(i(),l("div",{key:n,class:Y(["border p-2",a!=null&&a.isPast?"text-muted":"",a&&!a.isBooked&&!a.isPast?"bg-success text-white":"",a!=null&&a.isBooked?"bg-danger text-white":"","calendar-day"]),onClick:_=>a&&oe(a),style:{cursor:"pointer"}},[a?(i(),l("strong",Me,v(a.date.getDate()),1)):W("",!0)],10,xe))),128))]))),128))]),m.value?(i(),l("div",Be,[o("h2",Ie,"Godziny dla "+v(m.value.date.toLocaleDateString()),1),o("div",Pe,[(i(),l(h,null,k(L,e=>o("button",{key:e,disabled:N(e),onClick:c=>ae(e),class:Y(["btn",N(e)?"btn-secondary disabled":"btn-outline-primary",e===z.value?"border border-primary":""])},v(e),11,Te)),64))])])):W("",!0)])):w.value===3?(i(),l("div",Ae,[Fe,o("form",{onSubmit:re(ne,["prevent"]),class:"needs-validation"},[o("div",Ne,[Ve,T(o("select",{"onUpdate:modelValue":s[3]||(s[3]=e=>r.value.specialization=e),required:"",class:"form-select"},[je,(i(!0),l(h,null,k(G(R),e=>(i(),l("option",{key:e,value:e},v(e),9,Oe))),128))],512),[[K,r.value.specialization]])]),o("div",Ue,[We,T(o("select",{"onUpdate:modelValue":s[4]||(s[4]=e=>r.value.doctor=e),required:"",class:"form-select"},[Ke,(i(!0),l(h,null,k(G(X),e=>(i(),l("option",{key:e.id,value:e.name},v(e.name),9,qe))),128))],512),[[K,r.value.doctor]])]),o("div",He,[$e,T(o("textarea",{"onUpdate:modelValue":s[5]||(s[5]=e=>r.value.description=e),required:"",minlength:"10",class:"form-control",rows:"3"},null,512),[[ue,r.value.description]])]),Ee],40,Le)])):W("",!0)]))}},Ze=le(Ge,[["__scopeId","data-v-23e3acaf"]]);export{Ze as default};
