import{_ as le,f as u,Z as P,s as ie,g as ce,c as l,l as W,b as s,m as L,v as K,F as f,h as k,t as p,V as G,x as ue,u as re,M as q,N as D,p as de,i as ve,B as C,o as i,n as Y,z as pe,$ as me,W as Z}from"./index-8pIQ3OZO.js";const d=x=>(de("data-v-ac8d28cc"),x=x(),ve(),x),be={class:"container my-4"},_e={key:0,class:"mb-4"},ye=d(()=>s("h2",{class:"display-4 text-center mb-6"},"Umów wizytę – krok 1: wybierz przychodnię",-1)),he={class:"mb-3"},fe=d(()=>s("option",{disabled:"",value:""},"-- Wybierz przychodnię --",-1)),ke=["value"],we=["disabled"],ze={key:1,class:"mb-4"},ge={class:"d-flex justify-content-between align-items-center mb-3"},Se={class:"m-0"},De={class:"d-grid mb-2",style:{"grid-template-columns":"repeat(7, 1fr)","text-align":"center"}},Ce={class:"calendar"},xe=["onClick"],Me={key:0},Be={key:0,class:"mt-4"},Ie={class:"display-4 text-center"},Pe={class:"d-flex flex-wrap justify-content-center gap-2 mt-2"},Le=["disabled","onClick"],Ne={key:2,class:"mb-4"},Te=d(()=>s("h2",{class:"display-4 text-center"},"Krok 3: szczegóły wizyty",-1)),Ae=["onSubmit"],Fe={class:"mb-3"},Ve=d(()=>s("label",{class:"form-label"},"Specjalizacja:",-1)),je=d(()=>s("option",{disabled:"",value:""},"-- wybierz --",-1)),Oe=["value"],Ue={class:"mb-3"},We=d(()=>s("label",{class:"form-label"},"Lekarz:",-1)),Ke=d(()=>s("option",{disabled:"",value:""},"-- wybierz --",-1)),qe=["value"],He={class:"mb-3"},$e=d(()=>s("label",{class:"form-label"},"Opis dolegliwości:",-1)),Ee=d(()=>s("p",{class:"fw-bold"},"Koszt wizyty: 150 PLN",-1)),Ge=d(()=>s("button",{type:"submit",class:"btn btn-success"},"Zapisz wizytę",-1)),Ye={__name:"AppointmentForm",setup(x){const w=u(1),N=u([]),v=u(""),m=u(null),z=u(null),M=new Date,g=u(M.getMonth()),S=u(M.getFullYear()),J=["Styczeń","Luty","Marzec","Kwiecień","Maj","Czerwiec","Lipiec","Sierpień","Wrzesień","Październik","Listopad","Grudzień"],Q=["Pn","Wt","Śr","Cz","Pt","So","Nd"],T=u([]),b=u({}),y=u({}),A=["09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00"],r=u({specialization:"",doctor:"",description:""}),B=u([]),I=P(()=>B.value.length),H=P(()=>{var e;if(!m.value||!z.value)return B.value;const t=m.value.date.toISOString().split("T")[0],o=((e=y.value[t])==null?void 0:e[z.value])||[];return B.value.filter(c=>!o.includes(c.name))}),R=P(()=>[...new Set(H.value.map(t=>t.specialization))]),X=P(()=>H.value.filter(t=>t.specialization===r.value.specialization));async function ee(){const t=await q(D(C,"clinics"));N.value=t.docs.map(o=>({id:o.id,...o.data()}))}async function $(){const t=await q(D(C,"clinics",v.value,"doctors"));B.value=t.docs.map(o=>({id:o.id,...o.data()}))}async function te(){const t=await q(D(C,"clinics",v.value,"appointments"));b.value={},y.value={},t.docs.forEach(o=>{const{date:e,hour:c,doctor:a}=o.data(),n=e.toDate().toISOString().split("T")[0];b.value[n]=b.value[n]||{},b.value[n][c]=(b.value[n][c]||0)+1,y.value[n]=y.value[n]||{},y.value[n][c]=y.value[n][c]||[],y.value[n][c].push(a)})}function E(){if(!v.value||I.value===0){T.value=[];return}const o=(new Date(S.value,g.value,1).getDay()+6)%7,e=new Date(S.value,g.value+1,0).getDate(),c=[];let a=Array(7).fill(null),n=1;for(let _=o;_<7;_++,n++){const h=new Date(S.value,g.value,n),V=h.toISOString().split("T")[0],j=b.value[V]||{},O=A.every(U=>(j[U]||0)>=I.value);a[_]={date:h,isPast:h<M,isBooked:O}}for(c.push(a);n<=e;){a=Array(7).fill(null);for(let _=0;_<7&&n<=e;_++,n++){const h=new Date(S.value,g.value,n),V=h.toISOString().split("T")[0],j=b.value[V]||{},O=A.every(U=>(j[U]||0)>=I.value);a[_]={date:h,isPast:h<M,isBooked:O}}c.push(a)}T.value=c}ie([g,S],E,{immediate:!0});async function se(){w.value=2,await $(),await te(),E()}function oe(t){!t.isBooked&&!t.isPast&&(m.value=t)}function F(t){var c;const o=m.value.date.toISOString().split("T")[0];return(((c=b.value[o])==null?void 0:c[t])||0)>=I.value}async function ae(t){F(t)||(z.value=t,w.value=3,await $())}async function ne(){const t=pe.currentUser;if(!t)return;const o={userId:t.uid,clinicId:v.value,clinicName:N.value.find(e=>e.id===v.value).name,date:me.fromDate(m.value.date),hour:z.value,specialization:r.value.specialization,doctor:r.value.doctor,description:r.value.description,paymentMethod:"PLN"};await Z(D(C,"clinics",v.value,"appointments"),o),await Z(D(C,"users",t.uid,"appointments"),o),alert("Wizyta zarezerwowana!"),r.value={specialization:"",doctor:"",description:""},m.value=null,z.value=null,w.value=1}return ce(ee),(t,o)=>(i(),l("div",be,[w.value===1?(i(),l("div",_e,[ye,s("div",he,[L(s("select",{"onUpdate:modelValue":o[0]||(o[0]=e=>v.value=e),class:"form-select"},[fe,(i(!0),l(f,null,k(N.value,e=>(i(),l("option",{key:e.id,value:e.id},p(e.name),9,ke))),128))],512),[[K,v.value]])]),s("button",{class:"btn btn-primary",disabled:!v.value,onClick:se},"Dalej",8,we)])):w.value===2?(i(),l("div",ze,[s("div",ge,[s("button",{class:"btn btn-outline-secondary",onClick:o[1]||(o[1]=(...e)=>t.prevMonth&&t.prevMonth(...e))},"<"),s("h2",Se,p(J[g.value])+" "+p(S.value),1),s("button",{class:"btn btn-outline-secondary",onClick:o[2]||(o[2]=(...e)=>t.nextMonth&&t.nextMonth(...e))},">")]),s("div",De,[(i(),l(f,null,k(Q,e=>s("div",{key:e,class:"fw-bold"},p(e),1)),64))]),s("div",Ce,[(i(!0),l(f,null,k(T.value,(e,c)=>(i(),l("div",{key:c,class:"d-grid",style:{"grid-template-columns":"repeat(7, 1fr)","text-align":"center"}},[(i(!0),l(f,null,k(e,(a,n)=>(i(),l("div",{key:n,class:Y(["border p-2",a!=null&&a.isPast?"text-muted":"",a&&!a.isBooked&&!a.isPast?"bg-success text-white":"",a!=null&&a.isBooked?"bg-danger text-white":"","calendar-day"]),onClick:_=>a&&oe(a),style:{cursor:"pointer"}},[a?(i(),l("strong",Me,p(a.date.getDate()),1)):W("",!0)],10,xe))),128))]))),128))]),m.value?(i(),l("div",Be,[s("h2",Ie,"Godziny dla "+p(m.value.date.toLocaleDateString()),1),s("div",Pe,[(i(),l(f,null,k(A,e=>s("button",{key:e,disabled:F(e),onClick:c=>ae(e),class:Y(["btn",F(e)?"btn-secondary disabled":"btn-outline-primary",e===z.value?"border border-primary":""])},p(e),11,Le)),64))])])):W("",!0)])):w.value===3?(i(),l("div",Ne,[Te,s("form",{onSubmit:re(ne,["prevent"]),class:"needs-validation"},[s("div",Fe,[Ve,L(s("select",{"onUpdate:modelValue":o[3]||(o[3]=e=>r.value.specialization=e),required:"",class:"form-select"},[je,(i(!0),l(f,null,k(G(R),e=>(i(),l("option",{key:e,value:e},p(e),9,Oe))),128))],512),[[K,r.value.specialization]])]),s("div",Ue,[We,L(s("select",{"onUpdate:modelValue":o[4]||(o[4]=e=>r.value.doctor=e),required:"",class:"form-select"},[Ke,(i(!0),l(f,null,k(G(X),e=>(i(),l("option",{key:e.id,value:e.name},p(e.name),9,qe))),128))],512),[[K,r.value.doctor]])]),s("div",He,[$e,L(s("textarea",{"onUpdate:modelValue":o[5]||(o[5]=e=>r.value.description=e),required:"",minlength:"10",class:"form-control",rows:"3"},null,512),[[ue,r.value.description]])]),Ee,Ge],40,Ae)])):W("",!0)]))}},Je=le(Ye,[["__scopeId","data-v-ac8d28cc"]]);export{Je as default};
