import{f as n,g as M,z as U,A as S,B as l,C as z,c as u,b as e,m as h,x as D,l as j,V as O,v as F,F as I,h as A,u as $,O as T,P as W,N as _,M as Z,o as r,t as E,D as X,W as H,R as k,S as q,X as x,Y as C}from"./index-CCzS54Yh.js";const Y={class:"container my-4"},G=e("h2",{class:"display-4 text-center mb-4"},"Umów zdalną konsultację",-1),J=["onSubmit"],K={class:"mb-3"},Q=e("label",{class:"form-label"},"Opis problemu",-1),ee={class:"mb-3"},te=e("label",{class:"form-label"},"Załącz zdjęcie (opcjonalnie)",-1),oe={key:0,class:"mt-2"},ae=["src"],se={class:"mb-3"},ne=e("label",{class:"form-label"},"Nagraj głos (opcjonalnie)",-1),le={key:0,class:"mt-2"},ie=["src"],ce={class:"mb-3"},ue=e("label",{class:"form-label"},"Data konsultacji",-1),re=["min"],de={class:"mb-3"},pe=e("label",{class:"form-label"},"Preferowana godzina kontaktu",-1),me=e("option",{disabled:"",value:""},"-- wybierz godzinę --",-1),ve=["value"],fe={class:"mb-3"},he=e("label",{class:"form-label"},"Numer telefonu",-1),_e=e("button",{type:"submit",class:"btn btn-success w-100"},"Wyślij zgłoszenie",-1),ye={__name:"RemoteAppointment",setup(be){const a=n({description:"",date:"",contactHour:"",phone:""}),d=n(null),p=n(null),m=n(null),v=n(null),V=new Date().toISOString().split("T")[0],b=["09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00"],g=n([...b]);function L(s){const t=s.target.files[0];t&&(d.value=t,p.value=URL.createObjectURL(t))}function N(s){const t=s.target.files[0];t&&(m.value=t,v.value=URL.createObjectURL(t))}async function P(){if(!a.value.date)return;const s=T(_(l,"remoteappointments"),W("date","==",a.value.date)),o=(await Z(s)).docs.map(i=>i.data().contactHour);g.value=b.filter(i=>!o.includes(i)),o.includes(a.value.contactHour)&&(a.value.contactHour="")}async function B(){const s=U.currentUser;if(!s)return;const t=S(l,"users",s.uid),o=parseInt(String(a.value.phone).replace(/\D/g,""));await X(t,{phone:o},{merge:!0});const i={userId:s.uid,description:a.value.description,date:a.value.date,contactHour:a.value.contactHour,phone:o},f=await H(_(l,"remoteappointments"),i),y=[];if(d.value){const c=k(q,`remoteappointments/${f.id}/image.jpg`);y.push(x(c,d.value).then(()=>C(c).then(w=>H(_(l,"remoteappointments",f.id,"uploads"),{type:"image",url:w}))))}if(m.value){const c=k(q,`remoteappointments/${f.id}/audio.mp3`);y.push(x(c,m.value).then(()=>C(c).then(w=>H(_(l,"remoteappointments",f.id,"uploads"),{type:"audio",url:w}))))}await Promise.all(y);const R=await z(t);R.exists()&&(a.value.phone=R.data().phone||""),alert("Zgłoszenie zostało wysłane!"),a.value={description:"",date:"",contactHour:"",phone:""},d.value=null,m.value=null,p.value=null,v.value=null,g.value=[...b]}return M(async()=>{const s=U.currentUser;if(s){const t=S(l,"users",s.uid),o=await z(t);o.exists()&&(a.value.phone=o.data().phone||"")}}),(s,t)=>(r(),u("div",Y,[G,e("form",{onSubmit:$(B,["prevent"])},[e("div",K,[Q,h(e("textarea",{"onUpdate:modelValue":t[0]||(t[0]=o=>a.value.description=o),class:"form-control",rows:"4",required:"",minlength:"10"},null,512),[[D,a.value.description]])]),e("div",ee,[te,e("input",{type:"file",accept:"image/*",capture:"environment",onChange:L,class:"form-control"},null,32),p.value?(r(),u("div",oe,[e("img",{src:p.value,alt:"Preview",class:"img-fluid rounded",style:{"max-width":"30vw"}},null,8,ae)])):j("",!0)]),e("div",se,[ne,e("input",{type:"file",accept:"audio/*",capture:"microphone",onChange:N,class:"form-control"},null,32),v.value?(r(),u("div",le,[e("audio",{src:v.value,controls:"",class:"w-100"},null,8,ie)])):j("",!0)]),e("div",ce,[ue,h(e("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=o=>a.value.date=o),class:"form-control",min:O(V),required:"",onChange:P},null,40,re),[[D,a.value.date]])]),e("div",de,[pe,h(e("select",{"onUpdate:modelValue":t[2]||(t[2]=o=>a.value.contactHour=o),required:"",class:"form-select"},[me,(r(!0),u(I,null,A(g.value,o=>(r(),u("option",{key:o,value:o},E(o),9,ve))),128))],512),[[F,a.value.contactHour]])]),e("div",fe,[he,h(e("input",{type:"tel","onUpdate:modelValue":t[3]||(t[3]=o=>a.value.phone=o),required:"",class:"form-control",minlength:"9"},null,512),[[D,a.value.phone]])]),_e],40,J)]))}};export{ye as default};
